<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: sensu | さよならインターネット]]></title>
  <link href="http://blog.kenjiskywalker.org/blog/categories/sensu/atom.xml" rel="self"/>
  <link href="http://blog.kenjiskywalker.org/"/>
  <updated>2015-02-11T02:44:42+09:00</updated>
  <id>http://blog.kenjiskywalker.org/</id>
  <author>
    <name><![CDATA[kenjiskywalker]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[sensuのmackerel用のmetrics handlerをつくった #mackerelio]]></title>
    <link href="http://blog.kenjiskywalker.org/blog/2014/09/25/sensu-mackerel-handler/"/>
    <updated>2014-09-25T14:38:00+09:00</updated>
    <id>http://blog.kenjiskywalker.org/blog/2014/09/25/sensu-mackerel-handler</id>
    <content type="html"><![CDATA[<p><a href="http://mackerelio.connpass.com/event/8458/">Mackerel Meetup #2 Tokyo</a>に参加してきました。</p>

<p>美味しいサバ料理頂いたりピザ頂いたりビール頂いたりして最高でした。<br/>
個人的には監視はSensuかnagiosかに任せて、<br/>
メトリクス周りをmackerelに任せたいなという構想があったりなかったりしています。</p>

<p>mackerelがDataDogを超えて全世界で使われるようになったら<br/>
面白そうですよね。</p>

<p>個人的にほしい機能は監視の充実より先にメトリクス周りの整備をしてほしいです。</p>

<p>@fujiwaraさんが、n分前と現在の差分データを取得できると良いとおっしゃっていて<br/>
それあったら便利だな〜、と便乗していました(もちろんZabbixは可能です)。</p>

<p>使うか使わないかはわかりませんが、Sensuのhandlerで<br/>
mackerelを指定できるようプラグインを作成しました。</p>

<p>hostの登録は別でしないといけませんが(plugin側で担保しても良いかも)<br/>
既にSensuを利用している方は、こちらのhandlerを入れてもらえれば<br/>
mackerelへmetricsを送信することが可能です。</p>

<p>どうぞご利用ください。</p>

<ul>
<li><a href="https://github.com/kenjiskywalker/sensu-community-plugins/blob/master/handlers/metrics/mackerel-metrics.rb">mackerel-metrics.rb</a></li>
<li><a href="https://github.com/kenjiskywalker/sensu-community-plugins/blob/master/handlers/metrics/mackerel-metrics.json">mackerel-metrics.json</a></li>
</ul>


<p><a href="https://github.com/sensu/sensu-community-plugins/pull/777">pull requst</a>中です。<br/>
777番目なのでめでたいです。</p>

<blockquote><p>はてな社の方へ<br/>
headerが雑なのでプロモーションも兼ねて編集して頂いた方がいいかもしれないです</p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Sensu Casual Talks #1 に行ってきた #sensucasual]]></title>
    <link href="http://blog.kenjiskywalker.org/blog/2014/09/17/sensu-casual/"/>
    <updated>2014-09-17T23:13:00+09:00</updated>
    <id>http://blog.kenjiskywalker.org/blog/2014/09/17/sensu-casual</id>
    <content type="html"><![CDATA[<p><a href="http://www.zusaar.com/event/7607003">Sensu Casual Talks #1</a>にいってきた。</p>

<p><img src="https://dl.dropboxusercontent.com/u/5390179/sensu-sushi.jpg" alt="https://dl.dropboxusercontent.com/u/5390179/sensu-sushi.jpg" /></p>

<p><a href="https://twitter.com/timwata">@timwata</a>さんのGraphiteのスケールの話が興味深かった。<br/>
3000台ぐらいのクライアントをSensuとGraphiteで見てるの<br/>
相当貴重な知見だと思う。</p>

<p>自分が話してきたのは特にどうということもなくて<br/>
Chefを使えばOfficial cookbookと自分で何個かcookbookを書くことで<br/>
比較的簡単に(※1)導入、運用ができるという話をしてきた。</p>

<script async class="speakerdeck-embed" data-id="a9228a4020a1013253af5234a31dec8b" data-ratio="1.33333333333333" src="//speakerdeck.com/assets/embed.js"></script>


<p></p>

<p>cookbookはここにまとめてある。</p>

<p><a href="https://github.com/kenjiskywalker/chef/tree/master/site-cookbooks">https://github.com/kenjiskywalker/chef/tree/master/site-cookbooks</a></p>

<p>Sensu、スケールしていくとどこがボトルネックになるか<br/>
みたいな話はユースケースが増えていくとコツみたいなのが<br/>
見えてくると思う。だけどnagiosで困っていないのにわざわざ<br/>
sensuに乗り換えるのは無駄だと思う。</p>

<p>KAIZEN社は日本のウェッブ業界でも最先端の会社なので<br/>
定期的に現状を確認しに行きたいと思う。</p>

<p>Tシャツありがとうございました。<br/>
開催して頂いた@glidenote氏、ありがとうございました！</p>

<iframe src="//instagram.com/p/tDBpKKJqkv/embed/" width="612" height="710" frameborder="0" scrolling="no" allowtransparency="true"></iframe>


<blockquote><p>※1… 個人差があります</p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Monitoring monitor_agent by Sensu]]></title>
    <link href="http://blog.kenjiskywalker.org/blog/2014/07/09/monitor_agent-and-sensu/"/>
    <updated>2014-07-09T19:39:00+09:00</updated>
    <id>http://blog.kenjiskywalker.org/blog/2014/07/09/monitor_agent-and-sensu</id>
    <content type="html"><![CDATA[<h2>TL;DR</h2>

<p>Monitor the state of the Fluentd by Sensu.<br/>
SensuでFluentdの状態を監視する</p>

<h3>利用するソフトウェア(Using Software)</h3>

<ul>
<li><a href="https://github.com/fluent/fluentd">fluentd</a></li>
<li><a href="https://github.com/sensu/sensu">Sensu</a></li>
<li><a href="https://github.com/sensu/sensu-community-plugins/blob/master/plugins/fluentd/check-fluentd-monitor-agent.rb">check-fluentd-monitor-agent.rb</a></li>
</ul>


<h3>監視設定(Monitoring Settings)</h3>

<p>Sensu&rsquo;s Configuration Example<br/>
Sensuの設定例</p>

<p><code>check_fluentd_monitor_agent.json</code></p>

<pre><code>{
  "checks": {
    "check_fluentd_monitor_agent_retry": {
      "command": "/etc/sensu/plugins/check-fluentd-monitor-agent.rb -w 5 -c 10 -m 'retry_count'",
      "interval": 60,
      "occurrences": 3,
      "subscribers": ["foo"],
      "handlers": ["hipchat", "mailer"]
    },
    "check_fluentd_monitor_agent_buffer_total_queued_size": {
      "command": "/etc/sensu/plugins/check-fluentd-monitor-agent.rb -w 1024000 -c 51200000 -m 'buffer_queue_length'",
      "interval": 60,
      "occurrences": 3,
      "subscribers": ["foo"],
      "handlers": ["hipchat", "mailer"]
    }
  }
}
</code></pre>

<ul>
<li>アラート例(Example Alert)</li>
</ul>


<pre><code>CheckFluentdMonitorAgent WARNING: plugin_id object:XXXXXXX retry_count 8
</code></pre>

<ul>
<li>アラートが出ているプラグインの確認(Check the plug-in target)</li>
</ul>


<pre><code>$ curl http://localhost:24220/api/plugins.json | jq . | grep -10 XXXXXXX
</code></pre>

<p>Thus, It is useful to grasp if Fluentd could not be temporarily connected to the another service.<br/>
このように、Fluentdが他のサービスへ一時的に接続できなかった場合にアラートが来たりして便利です。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Created check-fluentd-monitor-agent of sensu-plugin]]></title>
    <link href="http://blog.kenjiskywalker.org/blog/2014/05/30/sensu-plugin-check-fluentd-monitor-agent/"/>
    <updated>2014-05-30T19:08:00+09:00</updated>
    <id>http://blog.kenjiskywalker.org/blog/2014/05/30/sensu-plugin-check-fluentd-monitor-agent</id>
    <content type="html"><![CDATA[<p>Colleagues said to me that I want to monitoring fluentd&rsquo;s state,<br/>
Then I created this plugin.<br/>
同僚がfluentdの状態を監視したいと言っていたので<br/>
私はこのプラグインをつくりました。</p>

<ul>
<li><a href="http://docs.fluentd.org/articles/monitoring">Monitoring Fluentd - fluentd</a></li>
<li><a href="https://github.com/sensu/sensu-community-plugins/blob/master/plugins/fluentd/check-fluentd-monitor-agent.rb">sensu-community-plugins/plugins/fluentd/check-fluentd-monitor-agent.rb</a></li>
</ul>


<p>how to use.<br/>
使い方</p>

<pre><code>{
  "checks": {
    "check_fluentd_monitor_agent_retry": {
      "command": "/etc/sensu/plugins/check-fluentd-monitor-agent.rb -w 5 -c 10 -m 'retry_count'",
      "interval": 60,
      "occurrences": 1,
      "subscribers": ["foo"],
      "handlers": ["hipchat", "mailer"]
    },
    "check_fluentd_monitor_agent_buffer_total_queued_size": {
      "command": "/etc/sensu/plugins/check-fluentd-monitor-agent.rb -w 1024 -c 5120 -m 'buffer_queue_length'",
      "interval": 60,
      "occurrences": 1,
      "subscribers": ["foo"],
      "handlers": ["hipchat", "mailer"]
    }
  }
}
</code></pre>

<p>Please try it.<br/>
よかったらご利用ください。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Sensuで一つのJSONファイルに複数の設定を記述する]]></title>
    <link href="http://blog.kenjiskywalker.org/blog/2014/05/12/sensu-multi-settings/"/>
    <updated>2014-05-12T16:40:00+09:00</updated>
    <id>http://blog.kenjiskywalker.org/blog/2014/05/12/sensu-multi-settings</id>
    <content type="html"><![CDATA[<p>deep_mergeなのでこう書けます。</p>

<ul>
<li>/etc/sensu/conf.d/checks/check_hoge.json</li>
</ul>


<pre><code>{
  "checks": {
    "check_hoge_one": {
      "command": "/etc/sensu/plugins/check-hoge.rb -C 1",
      "interval": 60,
      "subscribers": ["all"],
      "handlers": ["hipchat", "mailer"]
    },
    "check_hoge_two": {
      "command": "/etc/sensu/plugins/check-hoge.rb -C 2",
      "interval": 60,
      "subscribers": ["all"],
      "handlers": ["hipchat", "mailer"]
    },
    "check_hoge_three": {
      "command": "/etc/sensu/plugins/check-hoge.rb -C 3",
      "interval": 60,
      "subscribers": ["all"],
      "handlers": ["hipchat", "mailer"]
    }
  }
}
</code></pre>
]]></content>
  </entry>
  
</feed>
