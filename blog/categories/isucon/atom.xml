<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: isucon | さよならインターネット]]></title>
  <link href="http://blog.kenjiskywalker.org/blog/categories/isucon/atom.xml" rel="self"/>
  <link href="http://blog.kenjiskywalker.org/"/>
  <updated>2015-12-09T09:47:28+09:00</updated>
  <id>http://blog.kenjiskywalker.org/</id>
  <author>
    <name><![CDATA[kenjiskywalker]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[#isucon 4の予選に出た]]></title>
    <link href="http://blog.kenjiskywalker.org/blog/2014/10/06/isucon4/"/>
    <updated>2014-10-06T13:46:00+09:00</updated>
    <id>http://blog.kenjiskywalker.org/blog/2014/10/06/isucon4</id>
    <content type="html"><![CDATA[<p>ISUCON4に参加してきました。</p>

<ul>
<li><a href="http://isucon.net/archives/40576269.html">ISUCON4 本戦出場者決定のお知らせと本選出場者の利用言語比率</a></li>
</ul>


<p>上記の結果本戦出場にはたどり着けませんでした。<br/>
もし次回ISUCONがあれば、AMI提出の確認は全員で行いたいと思います。</p>

<blockquote><p>競技終了前に、全員でレギュレーション音読<br/>
競技終了後に、全員でAMI提出指差し確認実施</p></blockquote>

<h3>やったこと</h3>

<ul>
<li>とくになし</li>
</ul>


<h3>振り返り</h3>

<p>チームとして前進した気がする。</p>

<ul>
<li>走りだす前に全体つかむことができてよかった</li>
<li>実装前にその実装が可能かどうか確認することができてよかった</li>
<li>再起動を終了1時間前に実施できたのはよかった</li>
<li>全体のアクセスの統計とレスポンスタイムが遅いアクセスの割合を出した</li>
<li>335さんとひさいちが読んでコード書いててくれたのでここオンメモリやろ〜ヤジってればよかった</li>
<li>コンテキストスイッチ気にしすぎた。それよりもindexの改善はオレの役割だった</li>
</ul>


<p>4になって、事前に準備できることはしておかないといけない<br/>
リアル競技になってきた感が強い。</p>

<h2>参考</h2>

<ul>
<li><a href="http://hisaichi5518.hatenablog.jp/entry/2014/09/30/001034">#isucon 4の予選に出た - パルカワ2</a></li>
<li><a href="http://soh335.hatenablog.com/entry/2014/09/30/003912">#isucon 4 の予選に参加した- @soh335 memo</a></li>
</ul>


<p>運営の方、お疲れ様でした！<br/>
データホテルチームがんばれ〜</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[#isucon 2013 予選1日目に参加しました]]></title>
    <link href="http://blog.kenjiskywalker.org/blog/2013/10/07/isucon2013/"/>
    <updated>2013-10-07T09:55:00+09:00</updated>
    <id>http://blog.kenjiskywalker.org/blog/2013/10/07/isucon2013</id>
    <content type="html"><![CDATA[<p><a href="http://isucon.net/">isucon 2013</a>の1日目に参加しました。<br/>
@fujiwaraさん、@acidlemonさんありがとうございました。<br/>
本戦の問題作成頑張ってくださいね(・ω&lt;)</p>

<p>細かいことは<a href="http://soh335.hatenablog.com/entry/2013/10/06/230741">isucon3 の予選に参加しました #isucon - @soh335 memo</a>に書いてあります。<br/>
大切なことは<a href="http://hisaichi5518.hatenablog.jp/entry/2013/10/07/094347">#isucon の予選に参加してきた。 - パルカワ2</a>に書いてあります。</p>

<p>補足としては、ひさいち君は335さんがあれ〜〜〜〜〜？？？なんで〜〜〜〜？？？<br/>
って言い出したらコード見てこれがこうじゃない？？？って言って、<br/>
あ〜〜〜〜〜〜〜〜〜！！！っていう<br/>
デバッグ職人の役割とアプリケーションの細かい修正とかをやってもらってました。<br/>
漫画読んでたのは残り時間2時間残して、5位以内当確間違いないでしょ〜みたいな<br/>
奢りの象徴でした。</p>

<p>残り2時間ぐらいやることなくなったのは、<br/>
workload数を昔のISUCONのレギュレーションと勘違いして<br/>
時間内の最高スコアが実スコアなのに、最後に運営側で回したスコアがそれだろ。<br/>
って335さんと勘違いしてworkload 1しばりやってたからでした。<br/>
これはひさいちが遅刻してこなければ免れたかもしれません。</p>

<p>開始からいきなり忙しいぶってたり、攻殻機動隊のサントラをかけろ！！！<br/>
gitの設定より先にそれやれ、gitはオレがやるから！！！な！！<br/>
テンションあげてこ！！！？？とかやらずに<br/>
開始と同時に、良い茶葉が入りましたので、<br/>
ハーブティーでも飲みませんか？ぐらいの心の余裕が必要でした。</p>

<p>それと、ベンチマーク走らせる度に <br/>
「カムカムカムカム〜〜〜〜〜〜〜〜〜！！！！」「ノオ〜〜〜〜〜〜〜〜〜！！！！」<br/>
「ワイワイワイワイワイエラー！！！」<br/>
「きっとベンチマーク遅くなると思うけどやらせてくれッッ！！！！」<br/>
「ヒュ〜〜〜〜〜〜！！！キマったぜ！！！」みたいに<br/>
やたらテンションが高かったのも反省点でした。</p>

<p>自分がやったことは<br/>
1- nginx化はボトルネックわかってからやろう！って言ってたのに<br/>
nginx化してもらわないとわからないみたいな<br/>
当たり屋みたなこと言われて渋々ボトルネック探す前にnginx化し、<br/>
ログフォーマットはLTSVを利用し、必要最低限のログだけ出すようにし、<br/>
閲覧性を向上させていました。</p>

<p>2- MySQLは、結局見ませんでしたが<br/>
取り敢えずクエリを全部吐くようにしてログに出しておきました。</p>

<p>3- ボトルネック探しはdstatとiotopでCPUとI/O周りを確認していました。<br/>
一番効果があったのはDBIx::SunnyがどこのコードがそのSQL吐いてるのか<br/>
クエリに出してくれるので、そこひたすら眺め<br/>
335さんとこうした方が良い、ああした方が良い。って話していました。<br/>
実装は全部335さんに任せていました。</p>

<p>SQLで重い処理はRedisに持って行きました。<br/>
Redis、長期的に運用すること考えない場合こんなに楽なのか〜って震えました。</p>

<p>4- 335さんがRedisの実装書いてる時はチラチラコード読んで、データの中身確認して</p>

<blockquote class="twitter-tweet"><p>こそ泥みたいなチューニングしてる <a href="https://twitter.com/search?q=%23isucon&amp;src=hash">#isucon</a></p>&mdash; kenjiskywalker (@kenjiskywalker) <a href="https://twitter.com/kenjiskywalker/statuses/386401079199399936">October 5, 2013</a></blockquote>


<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>


<p></p>

<p>こんな感じのことをしていました。</p>

<p>残り2時間ぐらいになってくると、innodb_buffer_pool_size上げるだけ上げたので<br/>
ほとんどのデータがメモリに載り、Disk Readなどほとんどなくなり<br/>
サーバの資源がだいぶ余る感じになってきて、nginxの受け口増やしたりアプリの起動数<br/>
増やしたりしても変わらなくなってきてて、これはベンチマークツールの限界だな(笑)<br/>
などとフラグを立てることに集中していました。</p>

<blockquote class="twitter-tweet"><p><a href="https://twitter.com/search?q=%23isucon&amp;src=hash">#isucon</a> 予選中間発表続き &#10;6. 335&#10;7. isuco&#10;8. 代々木の緑色の会社&#10;9. └(&#39;-&#39;└)&#10;10. Noder&#10;&#10;1位のスコアは14926.8点です</p>&mdash; 941 (@941) <a href="https://twitter.com/941/statuses/386386639297069056">October 5, 2013</a></blockquote>


<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>


<p>この時の計測時点で8000とかで3位ぐらいには入れるな。みたな感じだったのですが<br/>
ここからみなさん怒涛のスコアアップがはじまり、五桁台が当たり前になり</p>

<p>エッエッ？？？？って完全にパニックに陥って、5位もあやしくなってきて<br/>
「なにこれ？？？何が起こってるんです？？？」<br/>
「5位以内じゃなきゃ死んだも同然だ！！！」<br/>
「ディスクリードだ！！！ディスクリードさえなくせばええんや！！！」<br/>
「もう温泉に行こう！！！」と完全に冷静さを失い、<br/>
時間から逆算しても抜本的な対策もできなくなり</p>

<p>残り1時間ぐらいはiptablesオフったりtcp_tw_recycle設定したり<br/>
skip_innodb_doublewriteの設定いじったりして、微妙にスコア伸びましたが、<br/>
全然5桁行く感じではなくて、時間ももうなくて<br/>
もうダメだ！！！温泉行こう！！！温泉！！！な！！！みたいな感じになっていました。</p>

<p>結果敵に</p>

<blockquote class="twitter-tweet"><p>こそ泥みたいなチューニングで5位以内確定できるかと思ってたら無理っぽい <a href="https://twitter.com/search?q=%23isucon&amp;src=hash">#isucon</a></p>&mdash; kenjiskywalker (@kenjiskywalker) <a href="https://twitter.com/kenjiskywalker/statuses/386405476218314752">October 5, 2013</a></blockquote>


<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>


<p>こうなりました。</p>

<p>同じ会社という利点を利用して</p>

<blockquote class="twitter-tweet"><p>チーム335、社内IRCでめっちゃつっかかってる <a href="https://twitter.com/search?q=%23isucon&amp;src=hash">#isucon</a></p>&mdash; kenjiskywalker (@kenjiskywalker) <a href="https://twitter.com/kenjiskywalker/statuses/386422737968705536">October 5, 2013</a></blockquote>


<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>


<p></p>

<p>こんな感じでworkloadの文章がわかりづらいとつっかかっていました。<br/>
どうしようもないですね。結果敵にNoderと50ms or die.チームもworkload 1縛りで<br/>
我々より上位にランクインしているので、小物感が増しただけでした。</p>

<p>本戦に出られたら、落ち着いて全体の実装全体確認して<br/>
対応の方向性決めてから手を動かすようにしたいと思います。</p>

<p>とても楽しかったです。<br/>
ありがとうございました。</p>
]]></content>
  </entry>
  
</feed>
