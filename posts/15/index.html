
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>さよならインターネット</title>
  <meta name="author" content="kenjiskywalker">

  
  <meta name="description" content="「七度の餓死に遇うとも、一度の戦いに遇うな」 1150年 ~ 1600年のデータ
応仁の乱前は3 ~ 5年に1回の割合で間欠的、集中的に飢饉と疫病が起きていた
応仁の乱後は2年に1回の割合で慢性的に飢饉と疫病が起きていた
天災の34%が旱魃、66%が長雨だった
「 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://kenjiskywalker.github.com/kenjiskywalker/posts/15/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="さよならインターネット" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37377904-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">さよならインターネット</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:kenjiskywalker.github.com/kenjiskywalker" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="http://d.hatena.ne.jp/kenjiskywalker/">Old Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/07/18/kiga-to-sensou/">「飢餓と戦争の戦国を行く」を読んだ</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-07-18T22:03:00+09:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://www.amazon.co.jp/gp/product/4022597879/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=4022597879&linkCode=as2&tag=13nightcrows-22"><img border="0" src="http://ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=4022597879&Format=_SL160_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=13nightcrows-22" ></a><img src="http://ir-jp.amazon-adsystem.com/e/ir?t=13nightcrows-22&l=as2&o=9&a=4022597879" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /></p>

<h3>「七度の餓死に遇うとも、一度の戦いに遇うな」</h3>

<ul>
<li>1150年 ~ 1600年のデータ</li>
<li>応仁の乱前は3 ~ 5年に1回の割合で間欠的、集中的に飢饉と疫病が起きていた</li>
<li>応仁の乱後は2年に1回の割合で慢性的に飢饉と疫病が起きていた</li>
<li>天災の34%が旱魃、66%が長雨だった</li>
<li>「町にはぶらぶら遊んでいる人ばかりで、農民の姿は少ない。必死に耕している人もいるが、聞こえてくるのは飢民が食を乞う声ばかりだ。日本には人は多いが、飢人もまた多く、疫病で動けなくなっている人も多い。彼らはいたるところの路ばたに集まってすわり、通る人ごとに銭を乞うている。」</li>
</ul>


<h2>生命維持の習慣</h2>

<ul>
<li>鎌倉時代、飢饉が発寛喜の飢饉をうけて、幕府は時限的に飢民奴隷精度を設けた</li>
<li>内容は、飢饉の年に誰かがもし飢えた人を買い取って養えば、養育の功労として奴隷にしてもいい</li>
<li>ただし人身売買は本来は国禁である</li>
<li>故に、これは飢饉の年だけの時限立法である</li>
<li>飢饉が去った後、売主が飢餓発生時に超安値で売った価格で買い戻そうとしても、それは無効である</li>
<li>売主と買主が双方合意しているのであれば、問題はない。など</li>
<li>ある宣教師のメモ「父親たちは、極度の貧窮に迫られた際に、自分たちの子供を売る、という習慣を今でも持っている」</li>
<li>北条泰時の施策<a href="http://d.hatena.ne.jp/Wallerstein/20090118/1232247150">『吾妻鏡』寛喜三年三月十九日条所収の北条泰時奉書－追加法２０ / 我が九条</a></li>
<li>田麦に税をかけてはならぬ</li>
<li>二毛作が流行った頃、百姓の夏の麦作ばかりが倍増して、領主は空きの年貢がろくに取れなかった。制限しようとするも、百姓たちは聞く耳持たず。麦年貢を徴収しようとしても、百姓たちは言うことを聞かない</li>
<li>百姓たちは田麦に精を出し、水田の稲の作付けが遅れ、水不足になる。百姓たちは日照りが原因だと年貢減免を言い立てる。 &lt;= 面白い</li>
</ul>


<h2>応仁の乱</h2>

<ul>
<li>応仁の乱の46年前に応永の大飢饉が発生する</li>
<li>翌年の春、都周辺の国々は深刻な飢餓と疫病に襲われる</li>
<li>周辺の国々から飢えた貧しい人々が難民となって京に殺到する</li>
<li>飢餓難民を救おうと、鴨川の五条の河原で仮小屋を設けて難民を収容し、粥の施しなどを行った。京にはまだ食料のゆとりはあった</li>
<li>粥を急に食べたのが命取りとなり、衰弱した人々の間には疫病も広がり、難民たちは尽く死んでいった</li>
<li>諸国の飢餓難民はまず山野、江河に食物を求めて殺到し、それも尽きると京に向かって物乞いの大きな奔流となっていった</li>
<li>食料生産地の村々が、大消費地の京より先に飢えた</li>
<li>難民たちの殺到で、ついには京も二次飢饉に襲われた</li>
<li>応仁の乱の24年前に嘉吉の大飢饉が発生する</li>
<li>「天下飢饉し、悪党充満す」といわれ、夜ごと高利貸しが襲われた</li>
<li>辺境の村が飢えると、生き延びるために京を目指し、時には高利貸しや富商を襲った</li>
<li>応仁の乱の20年前、台風、洪水、炎早による凶作、三日病や咳病流行る</li>
<li>徳政の土一揆起こる</li>
<li>応仁の乱の7年前、河内では畠山家の内戦が四年続いており、凶作と飢饉を加速させていた</li>
<li>寛正の大飢饉起こる。京には餓死者が山を成すほどであった</li>
<li>京は流入型飢饉とよばれる二次飢餓に襲われる</li>
<li>ある禅僧は嘆く「諸国の炎早、連年の災い」</li>
<li>食の乏しい端境期の三月になると、餓死者は鴨川にあふれて流れをふさぐほどだった</li>
<li>ある高僧曰く「去年は諸国が旱魃に襲われた。諸国ではお家騒動の戦乱が続き、領内の人は戦争難民、飢饉難民となり、京に流れ込んで餓死し、疫病まで広がっている。これは御成敗の不足、足利義政の政治が問題である」</li>
<li>飢饉発生時、金持ちは私財を投じ、難民は労働を施し、寺や橋、住宅をつくる事業モデルがあった</li>
<li>西芳寺では「ただ人に物を食わせ、何のなすことも無うては、その身のためにも悪い」と荒れた庭の修復作業を行い、労働に応じて食べ物を与えた</li>
<li>東大寺の再建を行った重源も同じように飢餓に苦しむ周防の人たちを雇い、食料と働き口を提供し、安く済ませることに成功している</li>
<li>足利義政の悪政の代表例である花の御所の復旧も、このモデルに沿ったものであったのではないか</li>
<li>何故生産者から先に飢餓難民になるのか。それは余剰分を都市へ分配しているのではなく、決められた作付けが強制され、それを上納することで村の生活の保証がされていた</li>
<li>この偏った受給システムにより、生産地がまず飢え、生き延びるために富が集中していた首都を目指したのではないか</li>
<li>一揆も頻繁に発生していた。<a href="http://ja.wikipedia.org/wiki/%E5%98%89%E5%90%89%E3%81%AE%E5%BE%B3%E6%94%BF%E4%B8%80%E6%8F%86">嘉吉の徳政一揆</a>が有名である</li>
<li>足軽の発生。応仁の乱発生時、土一揆が消え、戦場となった都には<a href="http://ja.wikipedia.org/wiki/%E8%B6%B3%E8%BB%BD">足軽</a>が大量に現れた</li>
<li>足軽とさえいえば、略奪も野放しであった</li>
<li>足軽は歴史的建造物も略奪の対象だった。その盗品を狙って商人が集まり、闇市が行われていた</li>
<li>寺宝を盗まれると、信者が闇市まで行き、買い取って寄付をしていた</li>
<li>足軽たちのルーツは周辺の貧民や浮浪民、また難民などであったのではないか。戦場の戦いは土一揆と同じ下克上の動きであり、第飢饉と過酷な搾取を生き延びてきた義憤の度合いが強く、故に富や物を盗むことに抵抗はなかったのではないか。という視点もある</li>
</ul>


<h2>奴隷売買</h2>

<ul>
<li>戦国時代になると、敵軍に攻められた村は奴隷狩りにあった</li>
<li>敵軍に攻められた村の村人は、衣類を身ぐるみ剥がされたり、田畑を荒らされたりした</li>
<li>女子供は強姦された。戦国時代、少年は男色の対象であったので、少女と同じように強姦の対象であった</li>
<li>大航海時代であったので、日本人が日本人の奴隷を売買し、島原からスペイン、ポルトガルの奴隷船に連れられマカオなどに売られていった</li>
<li>スペイン人に買われた少女の奴隷は、性奴隷となった</li>
</ul>


<h2>村の城</h2>

<ul>
<li>このように、戦国時代に敵軍に捉えられると悲惨な待遇が待ち受けているので、村人たちは自衛手段を持っていた</li>
<li>敵が攻めてきた場合は、金品を穴や井戸などに隠し、領内の城へ逃げた。城には戦闘員が２割で、残りの８割は逃げてきた村人という状態をよく見た</li>
<li>裏山などに村の城と呼ばれる避難用のエリアを用意していた。用意していたとは言うものの、軽い井戸があるだけや、木々を切り倒したものぐらいで、屋根などはない</li>
<li>村の武装用に穢多・非人を雇っていた。 &lt;= 差別対象として書かれていたが、差別対象になるのは江戸時代からなので、ここら辺の記述は要確認</li>
</ul>


<p>後半雑になったけど、取り敢えず何で応仁の乱でそんなに神仏の類のものが壊れたのか<br/>
戦国時代の村人はどうだったのかがなんとなく見えて面白かった。<br/>
特に応仁の乱については色々と疑問に思っていたところがあっただけに、難民流入と足軽の強奪という２点で、だいぶ納得がいった。</p>

<p>江戸時代前は本当に今の常識が通じないすごい世界だ。<br/>
しかし今までで１番長いエントリーだしこれからもこれを超えるエントリー書けなさそうだし業が深い</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/07/17/chef-run_list/">Chefの中身読んで、外部からrun_listを利用する</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-07-17T00:29:00+09:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>run_listを渡してるところを探した。<br/>
といってもほとんど<a href="https://twitter.com/soh335">@soh335</a>が教えてくれた。さすが一流エンジニアだ。</p>

<p><code>/chef/lib/chef/run_list.rb</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>def expansion_for_data_source(environment, data_source, opts={})
</span><span class='line'>  case data_source.to_s
</span><span class='line'>  when 'disk'
</span><span class='line'>    RunListExpansionFromDisk.new(environment, @run_list_items)
</span><span class='line'>  when 'server'
</span><span class='line'>    RunListExpansionFromAPI.new(environment, @run_list_items, opts[:rest])
</span><span class='line'>  end
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>ここが怪しかった。</p>

<p><code>/chef/spec/unit/run_list_spec.rb</code></p>

<p>ここ見たら</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>describe "from disk" do
</span><span class='line'>  it "should load the role from disk" do
</span><span class='line'>    Chef::Role.should_receive(:from_disk).with("stubby")
</span><span class='line'>    @run_list.expand("_default", "disk")
</span><span class='line'>  end
</span><span class='line'>
</span><span class='line'>  it "should log a helpful error if the role is not available" do
</span><span class='line'>    Chef::Role.stub!(:from_disk).and_raise(Chef::Exceptions::RoleNotFound)
</span><span class='line'>    Chef::Log.should_receive(:error).with("Role stubby (included by 'top level') is in the runlist but does not exist. Skipping expand.")
</span><span class='line'>    @run_list.expand("_default", "disk")
</span><span class='line'>  end
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>こんなん書いてあった。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#!/usr/bin/env ruby
</span><span class='line'>
</span><span class='line'>require 'rubygems'
</span><span class='line'>require 'pp'
</span><span class='line'>require 'json'
</span><span class='line'>require 'chef/run_list'
</span><span class='line'>
</span><span class='line'>json_file = "./json/yoshimasa.json"
</span><span class='line'>
</span><span class='line'>host_config = JSON.parse(File.read(json_file))
</span><span class='line'>
</span><span class='line'>Chef::Config[:cookbook_path] = '/root/chef/cookbook/'
</span><span class='line'>Chef::Config[:role_path] = '/root/chef/json/'
</span><span class='line'>
</span><span class='line'>run_list = Chef::RunList.new("recipe[nginx]", "role[hoge]")
</span><span class='line'>
</span><span class='line'>p run_list
</span><span class='line'># #&lt;Chef::RunList:0x7f6fb8732510 @run_list_items=[#&lt;Chef::RunList::RunListItem:0x7f6fb87323d0 @type=:recipe, @version=nil, @name="nginx"&gt;, #&lt;Chef::RunList::RunListItem:0x7f6fb87323a8 @type=:role, @version=nil, @name="hoge"&gt;]&gt;
</span><span class='line'>
</span><span class='line'>pp run_list.expand("_default", "disk")
</span><span class='line'># #&lt;Chef::RunList::RunListExpansionFromDisk:0x7f6fb8732100
</span><span class='line'>#  @applied_roles={"hage"=&gt;true, "hoge"=&gt;true},
</span><span class='line'>#  @default_attrs={},
</span><span class='line'>#  @environment="_default",
</span><span class='line'>#  @missing_roles_with_including_role=[],
</span><span class='line'>#  @override_attrs={},
</span><span class='line'>#  @recipes=["nginx", "postfix", "yum"],
</span><span class='line'>#  @run_list_items=[],
</span><span class='line'>#  @run_list_trace=
</span><span class='line'>#   {"role[hoge]"=&gt;["role[hage]", "recipe[postfix]", "recipe[yum]"],
</span><span class='line'>#    "top level"=&gt;["recipe[nginx]", "role[hoge]"]},
</span><span class='line'>#  @source=nil&gt;
</span><span class='line'>
</span><span class='line'>p run_list.expand("_default", "disk").recipes
</span><span class='line'># ["nginx", "postfix", "yum"]</span></code></pre></td></tr></table></div></figure>


<p>こんな感じでrun_listを読める。何が便利かっていうと</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>{
</span><span class='line'>  "run_list": [
</span><span class='line'>    "role[hage]"
</span><span class='line'>  ]
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>{
</span><span class='line'>  "run_list": [
</span><span class='line'>    "recipe[postfix]", "recipe[yum]"
</span><span class='line'>  ]
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>run_list = Chef::RunList.new("recipe[nginx]", "role[hoge]")
</span><span class='line'>
</span><span class='line'>...
</span><span class='line'>p run_list.expand("_default", "disk").recipes
</span><span class='line'># ["nginx", "postfix", "yum"]</span></code></pre></td></tr></table></div></figure>


<p>という感じにroleの中のrun_listを読み込んでrecipesに突っ込んでくれる。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/07/13/serverspec-chef-cookbook/">Testing #chef Cookbook by #serverspec #devops</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-07-13T13:04:00+09:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>serverspec use chef json file and cookbooks.<br/>
serverspec take run_list of <code>host.json</code>,<br/>
serverspec do test each <code>cookbook_name/spec/any_test_spec.rb</code>.</p>

<hr />

<h1>tools</h1>

<ul>
<li><a href="http://serverspec.org/">serverspec</a></li>
<li><a href="http://www.opscode.com/chef/">chef</a></li>
</ul>


<p>The configurations, please read at each document.</p>

<hr />

<h1>howto</h1>

<ul>
<li><h2>chef cookbooks</h2>

<p><code>/root/chef/cookbooks/{foo}/recipes/default.rb</code>
<code>/root/chef/cookbooks/{bar}/recipes/default.rb</code><br/>
&hellip;</p></li>
<li><h2>serverspec file</h2>

<p><code>/root/Rakefile</code><br/>
<code>/root/spec/spec_helper.rb</code><br/>
<code>/root/spec/{host_a}/host_a_mysql_spec.rb</code>   # host a specific test
<code>/root/spec/{host_a}/host_a_redis_spec.rb</code>   # host a specific test
<code>/root/spec/{host_b}/host_b_redis_spec.rb</code>   # host b specific test</p></li>
<li><h2>test file</h2>

<p><code>/root/chef/cookbooks/{foo}/spec/default_spec.rb</code><br/>
<code>/root/chef/cookbooks/{bar}/spec/default_spec.rb</code></p></li>
</ul>


<p> exp)<br/>
 <code>/root/chef/cookbooks/redis/spec/setting_spec.rb</code><br/>
 <code>/root/chef/cookbooks/redis/spec/process_spec.rb</code></p>

<h2><code>spec_helper.rb</code></h2>

<p><a href="http://serverspec.org/advanced_tips.html">Reference</a></p>

<div><script src='https://gist.github.com/6118553.js?file=spec_helper.rb'></script>
<noscript><pre><code></code></pre></noscript></div>


<h2><code>Rakefile</code></h2>

<div><script src='https://gist.github.com/6118553.js?file=Rakefile'></script>
<noscript><pre><code></code></pre></noscript></div>


<p>this Rakefile read <code>/root/chef/json/*.json</code> and <code>/root/chef/spec/host_name/*_spec.rb</code></p>

<p>Please match it with your environment.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>json_files = Dir::glob("./json/*.json")
</span><span class='line'> 
</span><span class='line'>Chef::Config[:cookbook_path] = './cookbook/'
</span><span class='line'>Chef::Config[:role_path]     = './json/'</span></code></pre></td></tr></table></div></figure>


<p>serverspec tests it look run_list of <code>host.json</code></p>

<p>exp</p>

<p><code>/root/chef/cookbooks/postfix/spec/default_spec.rb</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>require "/root/chef/spec/spec_helper"
</span><span class='line'>
</span><span class='line'>describe package('postfix') do
</span><span class='line'>    it { should be_installed }
</span><span class='line'>end
</span><span class='line'>
</span><span class='line'>describe service('postfix') do
</span><span class='line'>    it { should be_enabled }
</span><span class='line'>    it { should be_running }
</span><span class='line'>end
</span><span class='line'>
</span><span class='line'>describe port(25) do
</span><span class='line'>    it { should be_listening }
</span><span class='line'>end
</span><span class='line'>
</span><span class='line'># log file
</span><span class='line'>describe file('/var/log/maillog') do
</span><span class='line'>    it { should be_file }
</span><span class='line'>end
</span><span class='line'>
</span><span class='line'>describe file('/etc/postfix/main.cf') do
</span><span class='line'>    it { should be_file }
</span><span class='line'>end
</span><span class='line'>
</span><span class='line'>describe file('/etc/postfix/master.cf') do
</span><span class='line'>    it { should be_file }
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p><img src="http://gifzo.net/BIpiApSbg1E.gif" alt="http://gifzo.net/BIpiApSbg1E.gif" /></p>

<hr />

<p>英語でちゃんと書こうと思ったけど<br/>
取り敢えず出してあとでブラッシュアップする感じにしようと思った。<br/>
<code>Rakefile</code>いじくるだけで<code>chef</code>の<code>host.json</code>のrun_list見て<br/>
そのcookbookのspecディレクトリ見てテスト回してくれる。<br/>
roleとかも考慮されてるし、一括で入れられないテストについては<br/>
<code>/root/chef/spec/hostname/hoge_spec.rb</code>に入れればよしなに読み込んでくれる。<br/>
便利っぽい。</p>

<p>便利アピール海外にもしようと思ったら全然英語書けなくて頑張ろうって思った</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/07/10/readability-hatebu-ifttt/">IFTTTを使ってReadabilityでFavったエントリーをはてブする</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-07-10T22:10:00+09:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://podcast.bulknews.net/">ep15: After Google Reader, DIY Blogging, The Go language (typester)</a><br/>
を聞いてて、<a href="http://ifttt.com/">IFTTT</a>使って<a href="http://www.readability.com/">Readability</a>と<a href="http://b.hatena.ne.jp/">はてブ</a>の連携するの思い出した。</p>

<p><a href="http://weblog.bulknews.net/post/13811211811">快適に「あとで読む」ための環境 - TATSUHIKO MIYAGAWA&rsquo;S BLOG</a><br/>
このmiyagawaさんのエントリーを参考にして設定した。</p>

<p>やっていることは全部同じで、Gmailの設定して、PINコード受けて登録して
<img src="https://dl.dropboxusercontent.com/u/5390179/ifttt.png" alt="https://dl.dropboxusercontent.com/u/5390179/ifttt.png" /></p>

<p>こんな感じで本文にURLが入るようにして<br/>
<code>To address</code>にはてブの投稿用のメールアドレスを指定する。</p>

<p>この設定を入れると</p>

<p>ReadabilityでFav => はてブに登録</p>

<p>されるようになる。<br/>
ライフチェインジングだ。</p>

<p>長そうだな、後で読みたいなって思ったものは片っ端からReadabilityに突っ込む。<br/>
突っ込んだエントリーを移動中とか合間の時間に読んで、<br/>
良かったものははてブに登録するということをしていたので、<br/>
それがReadability側で完結するのとても捗る。おすすめです。</p>

<p>また、画像の一部を黒でマスキングすると昭和のエロ本みたいで趣が出る。<br/>
こちらも合わせておすすめしたい。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/07/10/hisaichi-tweet/">earthquake.gemプラグイン３つ</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-07-10T00:07:00+09:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://hisaichi5518.hatenablog.jp/entry/2013/07/09/111503">Twitterで言いたいけど、言えないようなツイートを楽に言えるようにした。 - パルカワ２</a></p>

<p>このearthquake.gemのpluginつくった。<br/>
<a href="https://gist.github.com/kenjiskywalker/5955552">https://gist.github.com/kenjiskywalker/5955552</a></p>

<p>この前日光でハッカソンしようとか話してて<br/>
結局つくりあげられなくて、メシ食う前の３０分でつくったプラグインもある。</p>

<p><a href="https://gist.github.com/kenjiskywalker/5787351">https://gist.github.com/kenjiskywalker/5787351</a><br/>
POSTを逆にするヤツ。</p>

<p><a href="https://gist.github.com/kenjiskywalker/5787448">https://gist.github.com/kenjiskywalker/5787448</a><br/>
POSTをランダムに並べ替えるヤツ。</p>

<p>もう少し生産的なものをつくりたい</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/06/30/serverspec-jenkins/">serverspecをJenkins氏で回す場合について</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-06-30T02:47:00+09:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>今流行りの<a href="http://serverspec.org/">serverspec</a>、みなさんどうやって活用しているのでしょうか。<br/>
インフラもCIだ！みたいな話最近よく聞くので、CIといえばJenkins！<br/>
的な感じで試してみました。</p>

<p>ほんのさわり程度やってみたところで、工夫が必要だと感じたのは<br/>
Jenkinsをどうやって回すか。という根本的なところです。</p>

<p>Jenkinsのアカウントをsudo許可するのか、別アカウントを用意するのか、<br/>
もうなんだったらルート権限付与してしまうのか。色々方法はあるかと思います。</p>

<p>ほんのさわり程度ですが、良さそうだなと感じたのは<br/>
<a href="https://wiki.jenkins-ci.org/display/JENKINS/Publish+Over+SSH+Plugin">Publish Over SSH Plugin</a>このプラグインを利用して<br/>
NOPASS sudo権限のあるアカウントを作成し、秘密鍵を設定して<br/>
Jenkins用のアカウントとしてSSHログインさせてテストを回すのが良いかなと。</p>

<p><img src="https://dl.dropboxusercontent.com/u/5390179/ea0d7aa2ae77caf8623cead6fdfa522e.png" alt="https://dl.dropboxusercontent.com/u/5390179/ea0d7aa2ae77caf8623cead6fdfa522e.png" /></p>

<p>ほんのさわり程度なので、もっと良い方法ありそうですね。</p>

<p>あと<a href="https://wiki.jenkins-ci.org/display/JENKINS/IRC+Plugin">IRC Plugin</a>これ、動かなくて<br/>
どっちかっていうとIRCでserverspecのテストの結果チラチラ見たいんんだよぉ〜<br/>
むしろその為にやってたんだよぉ〜ってなって、3時間ぐらいああだこうだやってて<br/>
なんで〜！！！ってなってたけど</p>

<ul>
<li><a href="http://ikasama.hateblo.jp/entry/2011/12/21/033421">Jenkins casual notification using Remote access API / 烏賊様</a></li>
</ul>


<p>ikasam_aさんのおかげでできるようになった！！！ありがたい！！！<br/>
もうちょっと触っていったら色々やりたい。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/06/29/jenkins-dnsmasq-chef/">さくらVPSでJenkinsたちあげたくてVPN繋いでdnsmasqで名前解決できるようにした</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-06-29T20:49:00+09:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Jenkins氏、存在は知ってるけど自分で使ったことなかったので<br/>
取り敢えずインストールしてみた。</p>

<p>さくらVPSだとグローバル経由でアクセスすることになって<br/>
誰でも見れちゃうので悲しい感じになる。<br/>
ということでVPNを貼って内部で接続しに行く。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>+--------+             +-----+
</span><span class='line'>| sakura | --- vpn --- | MBA |
</span><span class='line'>+--------+             +-----+
</span><span class='line'>[10.9.0.1]             [10.9.0.6]
</span></code></pre></td></tr></table></div></figure>


<p>VPNの貼り方とはか<a href="http://d.hatena.ne.jp/kenjiskywalker/20120702/1341226191">ここ</a>を見て貰いたい。</p>

<h3>Jenkins氏</h3>

<ul>
<li>/etc/sysconfig/jenkins</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>JENKINS_ARGS="--httpPort=${JENKINS_PORT} --ajp13Port=${JENKINS_AJP_PORT} --httpListenAddress=127.0.0.1"</span></code></pre></td></tr></table></div></figure>


<p>として、自分自身のアクセスだけ許可</p>

<h3>nginx氏</h3>

<ul>
<li>/etc/nginx/conf.d/hoge.conf</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>server {
</span><span class='line'>    listen 80;
</span><span class='line'>    server_name jenkins.kenjiskywalker.org;
</span><span class='line'>    root /home/skywalker/www;
</span><span class='line'>
</span><span class='line'>    location /{
</span><span class='line'>        proxy_pass http://localhost:8080;
</span><span class='line'>        allow 10.9.0.0/16;
</span><span class='line'>        deny all;
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>で、<code>jenkins.kenjiskywalker.org</code>でアクセスを受け付けるようにする。</p>

<p>MBAにdnsmasqを入れて<code>/usr/local/etc/</code>にPATH通しておいて</p>

<ul>
<li>/usr/local/etc/dnsmasq.conf</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>address=/jenkins.kenjiskywalker.org/10.9.0.1</span></code></pre></td></tr></table></div></figure>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo /usr/local/sbin/dnsmasq</span></code></pre></td></tr></table></div></figure>


<p>とかで起動させて、コントロールパネルの方で、DNSサーバを<br/>
<code>127.0.0.1</code>を最初に見に行かせるようにすれば名前解決できるようになる。<br/>
<code>homebrew.mxcl.dnsmasq.plist</code>があるので、それ使って継続的にdnsmasq上げると良さそう。</p>

<p>さて、さくらのVPS、メモリ1Gしかなくて心配だけど試してみよう。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/06/26/ajisai-2013/">2013 / あじさい / 鎌倉</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-06-26T00:47:00+09:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>あかっぽいあじさい</h3>

<p><img src="http://farm3.staticflickr.com/2821/9117215174_a318d68fc4_c.jpg" alt="http://farm3.staticflickr.com/2821/9117215174_a318d68fc4_c.jpg" /></p>

<h3>あおっぽいあじさい</h3>

<p><img src="http://farm4.staticflickr.com/3682/9117214348_220faf73dc_c.jpg" alt="http://farm4.staticflickr.com/3682/9117214348_220faf73dc_c.jpg" /></p>

<p>一眼もらったんだけど持ち歩くの面倒くさくて相変わらずDP2持って歩いてる。<br/>
DP2、家に帰るまでどんな感じで撮れてるのか全くわからないし<br/>
家で見ると７割ぐらいピント合ってなくて面白い。</p>

<p>確実性求めすぎない方が心に余裕生まれる気がする。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/06/18/reserved-instances/">AWSのリザーブドインスタンスについて理解していなかったので理解した</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-06-18T15:21:00+09:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2><a href="http://aws.amazon.com/jp/ec2/reserved-instances/">Amazon EC2 リザーブドインスタンス</a></h2>

<p>先に1年か3年かのどちらか使用する予定の期間の予約金を支払うことで<br/>
割り引いてもらえるサービス。</p>

<p>詳しくはこちら</p>

<h4><a href="http://aws.typepad.com/aws_japan/2011/12/additional-reserved-instance-options-for-amazon-ec2-.html">【AWS発表】 リザーブドインスタンスに新しい2つの料金モデルを追加</a></h4>

<p>古い情報なので値段など変更されている場合があるので<br/>
あくまで参考までに。</p>

<h4>リザーブドインスタンスの種類</h4>

<ul>
<li>軽度使用(Light)  RI</li>
<li>中度使用(Medium) RI</li>
<li>重度使用(Heavy)  RI</li>
</ul>


<h4>何が違うの？</h4>

<blockquote><p>15%以下:          オンデマンドインスタンス<br/>
15% - 40%:        ライトユース・リザーブドインタンス<br/>
40%-80%:          ミディアムユース・リザーブドインタンス<br/>
80%以上:          ヘビーユース・リザーブドインタンス</p></blockquote>

<p>上のパーセンテージは年間で使用するパーセント。<br/>
雑な計算をすると、365日中の15%だから、54.75日。<br/>
<code>54.75日以下</code>しか使わない場合はリザーブドインスタンスの方が損をしてしまう。<br/>
<code>15%以上(54.75) - 40%以内(146日)以内</code>であれば、軽度使用RIを使った方がお得。<br/>
どれぐらいお得かは参考ページに記載されている。</p>

<p>取り敢えず2ヶ月以上使う予定があれば軽度使用で安くなる。<br/>
ただ当たり前だけどインスタンスサイズ変更できないので<br/>
カジュアルにスケールアップすることができなくなる。<br/>
EC2が単体でスケールアウトができる構成じゃない場合つらくなる可能性ある。<br/>
不要になったRIはマーケットプレイスで販売もできるらしいけど<br/>
今はまだ米国専用って感じっぽい。</p>

<p>なにはともあれ選択ができるっていうのはありがたいことだ。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/06/05/daijinjyaten/">大神社展行ってきた</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-06-05T23:57:00+09:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="https://irs3.4sqi.net/img/general/680x680/314438_fmD0bexhswerJhwD2fxJSWC_dpkjLIvyAPRxHZ04P7g.jpg" alt="https://irs3.4sqi.net/img/general/680x680/314438_fmD0bexhswerJhwD2fxJSWC_dpkjLIvyAPRxHZ04P7g.jpg" /></p>

<h2><a href="http://daijinja.jp/">国宝 大神社展</a></h2>

<p>神道、基本アニミズム信仰だから仏教と違って<br/>
神を象ることはないんだけど、祀ることに関するものが色々あった。</p>

<p>色々あったけどどれも地味だったからあんまり面白くなかった。<br/>
そもそも神道が地味だからそんなもんだと思う。</p>

<p>秀吉の字がめちゃくちゃ汚いとか、空海の字がめちゃめちゃ綺麗だとか<br/>
そういう感じの面白さあんまりなかった。最終日に行ったから<br/>
人多くてそんなにちゃんと見なかったのが原因だと思う。</p>

<p>いずれにせよ原始的な宗教に変わりはないから<br/>
それはすごいなーって思った。<br/>
仏教、大乗仏教になって仏像とか彫っちゃってみんな好き勝手やりだしたけど<br/>
本来は神道みたいな地味なもんだったと思う。</p>

<p>隣りでやってた<a href="http://gj2013.jp/">グレートジャーニー人類の旅</a>が面白かった。<br/>
カミさんが異常に干し首に執着してて気持ち悪かった。<br/>
どうやって干し首つくったのか、みたいな映像熱心に見てた。</p>

<p>関野さんがイヌイットの人たちと生活していた映像あって、<br/>
セイウチの皮を綺麗に剥いで、捨てるものはなにもない。ってやってて<br/>
ああいうのもっとちゃんとやった方が良いって思った。<br/>
普段口にしてるもの、加工されてて死の実感ないのはよくない。<br/>
けど実際やれって言われたらだいぶ厳しい。イソメもちょっと厳しい。</p>

<p>NHKスペシャルで昔、<a href="http://www.nhk.or.jp/special/onair/110828.html">「日本人イヌイット　北極圏に生きる」</a>って番組やってて<br/>
よくこんなところに暮らせるなーって思った。</p>

<p>インカとかアマゾンとかで自然と共に生きるのと<br/>
経済社会の中で生きるの、幸せとは〜とか考えた。</p>

<p>最後に、人生とは旅なのかもしれない<br/>
「life is journey」って言葉があって、在り来りかもしれないけど<br/>
日々冒険だなって。</p>

<p>関係ないけど与論島行きたい。</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="16">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="14">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/12/07/201411-book/">2014/11読んだ本</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/12/07/jyoen/">俺の子連れおすすめスポット - 新宿御苑</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/12/02/capistrano3-rails4-unicorn/">capistrano3を利用してRails4をdeployしunicornを使う</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/11/17/ansible-vault-circleci/">Ansible Vaultで暗号化されたファイルをCircleCIで利用する</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/11/13/circleci-docker-ansible-serverspec/">CircleCIでDockerコンテナに対してansibleを実行しserverspecでテストをする</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/kenjiskywalker">@kenjiskywalker</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'kenjiskywalker',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - kenjiskywalker -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
